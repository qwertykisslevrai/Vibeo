<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<style>
body{font-family:Arial;background:#eee;padding:20px}
.box{background:white;padding:20px;border-radius:10px;margin-bottom:20px}
input,button{width:100%;padding:10px;margin:10px 0}
.code{background:#f4f4f4;padding:5px;border-radius:5px;font-family:monospace;}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, addDoc, collection } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQkCNtVCzXyIFLNlj9iKQvaMcg197zpKY",
  authDomain: "tttt-57bdb.firebaseapp.com",
  projectId: "tttt-57bdb",
  storageBucket: "tttt-57bdb.firebasestorage.app",
  messagingSenderId: "136572123296",
  appId: "1:136572123296:web:886d093854c6827f10b1c5",
  measurementId: "G-3E8ZVGPDTX"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth,user=>{
  if(!user || !user.emailVerified) location.href="index.html";
  email.textContent = user.email;
});

window.addVideo = async()=>{
  if(!title.value || !url.value){
    alert("Veuillez remplir le titre et le lien !");
    return;
  }
  await addDoc(collection(db,"videos"),{
    title: title.value,
    url: url.value, // lien Drive /preview
    authorEmail: auth.currentUser.email,
    authorUid: auth.currentUser.uid,
    views: 0,
    date: new Date()
  });
  alert("VidÃ©o publiÃ©e !");
  title.value = "";
  url.value = "";
};

window.logout = () => {
  signOut(auth);
  location.href="index.html";
};
</script>
</head>

<body>

<div class="box">
<h2>Profil</h2>
<p>Email : <span id="email"></span></p>
<button onclick="logout()">DÃ©connexion</button>
</div>

<div class="box">
<h2>Publier une vidÃ©o</h2>
<input id="title" placeholder="Titre de la vidÃ©o">
<input id="url" placeholder="Lien Google Drive /preview">
<button onclick="addVideo()">Publier</button>
</div>

<div class="box">
<h3>ğŸ“¤ Comment publier une vidÃ©o</h3>
<p>1. Upload votre vidÃ©o sur <strong>Google Drive</strong>.</p>
<p>2. Faites un clic droit sur la vidÃ©o â†’ <strong>Partager</strong>.</p>
<p>3. SÃ©lectionnez <strong>â€œAnyone with the linkâ€</strong> et vÃ©rifiez que la permission est <strong>Viewer</strong>.</p>
<p>4. Copiez le lien et transformez-le :</p>
<p class="code">https://drive.google.com/file/d/ID_DE_LA_VIDEO/preview</p>
<p>âš  Remplacez /view?usp=sharing par /preview.</p>
<p>5. Collez ce lien dans le champ â€œLien Google Drive /previewâ€ ci-dessus et cliquez sur <strong>Publier</strong>.</p>
<p>âœ… Votre vidÃ©o apparaÃ®tra automatiquement sur la page principale et est visible en plein Ã©cran.</p>
<p>ğŸ’¡ Bonnes pratiques : toujours vÃ©rifier le lien et que la vidÃ©o est publique. Si votre nom apparaÃ®t â€œundefinedâ€, republiez la vidÃ©o aprÃ¨s mise Ã  jour du code.</p>
</div>

</body>
</html>